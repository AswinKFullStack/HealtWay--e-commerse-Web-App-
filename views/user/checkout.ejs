<%- include("../../views/partials/user/header") %>
<link rel="stylesheet" href="/css/userCss/checkout.css">

    <!-- Checkout Section -->
    <div class="container mt-5">
        <h2 class="text-center">Checkout</h2>
        <form id="checkoutForm" onsubmit="return validateCheckoutForm()"  method="POST" novalidate>
            <!-- Address Section -->
            <div class="card mb-4">
                <div class="card-header">Shipping Address</div>
                <div class="card-body">
                    <!-- Dynamic Saved Addresses -->
                    <div id="savedAddresses">
                        <h5>Select an Address:</h5>
                    
                        <% if (addresses && addresses.length > 0) { %>
                            <% addresses.forEach(function(address, index) { %>
                            <div class="form-check list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <input class="form-check-input" type="radio" name="address" id="savedAddress<%= index %>" value="<%= address._id %>" <%= index === 0 ? 'checked' : '' %>>
                    
                                    <h5 class="mb-1"><%= address.addressType %> Address</h5> <!-- Display Address Type -->
                                    <p class="mb-1">
                                        <strong>Name:</strong> <%= address.name %><br>
                                        <strong>House/Apartment:</strong> <%= address.houseName %><br>
                                        <strong>Landmark:</strong> <%= address.landMark %><br>
                                        <strong>City:</strong> <%= address.city %><br>
                                        <strong>State:</strong> <%= address.state %><br>
                                        <strong>Pincode:</strong> <%= address.pincode %><br>
                                        <strong>Phone:</strong> <%= address.phone %><br>
                                        <% if (address.altPhone) { %>
                                            <strong>Alternate Phone:</strong> <%= address.altPhone %><br>
                                        <% } %>
                                        <small class="text-muted">
                                            Added on: 
                                            <% if (address.createdAt) { %>
                                                <%= new Date(address.createdAt).toDateString() %>
                                            <% } else if (address._id) { %>
                                                <%= address._id.getTimestamp().toDateString() %>
                                            <% } else { %>
                                                N/A
                                            <% } %>
                                        </small>
                                    </p>
                    
                                    <button type="button" class="btn btn-link" onclick="editAddress('<%= address._id %>')">Edit</button>
                                </div>
                            </div>
                            <% }); %>
                        <% } else { %>
                            <div class="alert alert-info">No saved addresses found. Please add a new address.</div>
                        <% } %>
                    
                        <!-- Pagination -->
                        <% if (totalPages > 1) { %> <!-- Only show pagination if there's more than one page -->
                        <div class="row mt-4">
                            <div class="col-md-12 text-center">
                                <!-- Previous Button -->
                                <% if (currentPage > 1) { %>
                                    <a href="/checkout?page=<%= currentPage - 1 %>&limit=<%= limit || 3 %>" class="btn btn-secondary">Previous</a>
                                <% } else { %>
                                    <button class="btn btn-secondary" disabled>Previous</button>
                                <% } %>
                    
                                <!-- Page Numbers -->
                                <% for (let i = 1; i <= totalPages; i++) { %>
                                    <a href="/checkout?page=<%= i %>&limit=<%= limit || 3 %>" class="btn <%= currentPage === i ? 'btn-primary active' : 'btn-primary' %>"><%= i %></a>
                                <% } %>
                    
                                <!-- Next Button -->
                                <% if (currentPage < totalPages) { %>
                                    <a href="/checkout?page=<%= currentPage + 1 %>&limit=<%= limit || 3 %>" class="btn btn-secondary">Next</a>
                                <% } else { %>
                                    <button class="btn btn-secondary" disabled>Next</button>
                                <% } %>
                            </div>
                        </div>
                        <% } %>
                    
                        <button type="button" class="btn btn-primary mt-3" onclick="addNewAddress()">Add New Address</button>
                    </div>
                    

                   
                    <!-- Add/Edit Address Form (Initially Hidden) -->
<div id="addressForm" class="mt-4 d-none">
    <h5 id="addressFormTitle">Add New Address</h5>
    <form action="/saveAddress" method="POST" novalidate>
        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="inputName">Name</label>
                <input type="text" class="form-control" id="inputName" name="name" placeholder="Full Name" required>
                <div class="invalid-feedback">Please enter your name.</div>
            </div>
            <div class="form-group col-md-6">
                <label for="inputHouseName">House/Apartment</label>
                <input type="text" class="form-control" id="inputHouseName" name="houseName" placeholder="House/Apartment" required>
                <div class="invalid-feedback">Please enter your house name.</div>
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="inputLandmark">Landmark</label>
                <input type="text" class="form-control" id="inputLandmark" name="landMark" placeholder="Landmark" required>
                <div class="invalid-feedback">Please enter a landmark.</div>
            </div>
            <div class="form-group col-md-6">
                <label for="inputCity">City</label>
                <input type="text" class="form-control" id="inputCity" name="city" placeholder="City" required>
                <div class="invalid-feedback">Please enter your city.</div>
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-4">
                <label for="inputState">State</label>
                <select id="inputState" class="form-control" name="state" required>
                    <option selected>Choose...</option>
                    <!-- Add options for states here -->
                    <option>Kerala</option>
                    <option>Tamilnadu</option>
                    <option>Karanadaka</option>
                </select>
                <div class="invalid-feedback">Please select a state.</div>
            </div>
            <div class="form-group col-md-4">
                <label for="inputPincode">Pincode</label>
                <input type="text" class="form-control" id="inputPincode" name="pincode" placeholder="Pincode" required>
                <div class="invalid-feedback">Please enter your pincode.</div>
            </div>
            <div class="form-group col-md-4">
                <label for="inputPhone">Phone</label>
                <input type="text" class="form-control" id="inputPhone" name="phone" placeholder="Phone" required>
                <div class="invalid-feedback">Please enter your phone number.</div>
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="inputAltPhone">Alternate Phone</label>
                <input type="text" class="form-control" id="inputAltPhone" name="altPhone" placeholder="Alternate Phone">
                <div class="invalid-feedback">Please enter your alternate phone number.</div>
            </div>
        </div>
        <button type="submit" class="btn btn-success">Save Address</button>
    </form>
</div>

                </div>
            </div>

            <!-- Product Details Section -->
            <div class="card mb-4">
                <div class="card-header">Order Summary</div>
                <div class="card-body">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th scope="col">Product</th>
                                <th scope="col">Price</th>
                                <th scope="col">Quantity</th>
                                <th scope="col">Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Kashmeeri Mulak Podi</td>
                                <td>₹200</td>
                                <td>
                                    <input type="number" value="1" min="1" class="form-control quantity" onchange="updateTotal(this)">
                                </td>
                                <td class="product-total">₹200</td>
                            </tr>
                            <tr>
                                <td>Malli Podi</td>
                                <td>₹150</td>
                                <td>
                                    <input type="number" value="1" min="1" class="form-control quantity" onchange="updateTotal(this)">
                                </td>
                                <td class="product-total">₹150</td>
                            </tr>
                            <tr>
                                <td>Manjal</td>
                                <td>₹180</td>
                                <td>
                                    <input type="number" value="1" min="1" class="form-control quantity" onchange="updateTotal(this)">
                                </td>
                                <td class="product-total">₹180</td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr>
                                <th colspan="3" class="text-right">Subtotal:</th>
                                <th id="subtotal">₹530</th>
                            </tr>
                            <tr>
                                <th colspan="3" class="text-right">GST (5%):</th>
                                <th id="gst">₹26.50</th>
                            </tr>
                            <tr>
                                <th colspan="3" class="text-right">Total:</th>
                                <th id="total">₹556.50</th>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>

            <!-- Payment Section -->
            <div class="card mb-4">
                <div class="card-header">Payment Method</div>
                <div class="card-body">
                    <h5>Select Payment Method:</h5>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="paymentMethod" id="creditCard" value="Credit Card" checked>
                        <label class="form-check-label" for="creditCard">
                            Credit Card
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="paymentMethod" id="debitCard" value="Debit Card">
                        <label class="form-check-label" for="debitCard">
                            Debit Card
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="paymentMethod" id="cod" value="Cash on Delivery">
                        <label class="form-check-label" for="cod">
                            Cash on Delivery
                        </label>
                    </div>
                    <button type="submit" class="btn btn-warning btn-block mt-4" style="background-color: #FFD700;" >Place Order</button>
                </div>
            </div>
        </form>
    </div>




<%- include("../../views/partials/user/footer") %>

<script src="/js/userJs/checkout.js"></script>