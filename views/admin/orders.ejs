<%- include("../../views/partials/admin/header") %>

<link rel="stylesheet" href="/css/adminCss/customers.css">

<h2 class="my-4">Order Management</h2>

<!-- Search bar for products -->
<div class="form-group mb-4">
    <input type="text" class="form-control" id="searchOrder" placeholder="Search products" value="<%= searchTerm %>">
</div>

<!-- Product Table -->
<table class="table table-striped">
    <thead>
        <tr>
            <th>Order ID</th>
            <th>User Name</th>
            <th>Quantity Of Items</th>
            <th>Delivery Address</th>
            <th>Total Price</th>
            <th>Created Date</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        <% orders.forEach(function(order) { %>        
            <tr>
                <td><%= order.orderedItems._id %></td>
                <td><%= order.userDetails[0].name%></td>
                <td><%= order.orderedItems.quantity %></td>
                <td><%= order.deliveryAddress[0].houseName %>,<%= order.deliveryAddress[0].city %>,<%= order.deliveryAddress[0].pincode %>,<%= order.deliveryAddress[0].phone %></td>
                <td><%= order.priceOfQuantity %></td>
                <td><%= order.createdOn %></td>
                <td><%= order.orderedItems.status %></td>
                <td>
                    <!-- Actions -->
                    <button class="btn btn-primary btn-sm" onclick="location.href='/admin/order/edit/<%= order._id %>/<%= order.orderedItems._id %>'">
                        <i class="bi bi-pencil-square"></i> Edit
                    </button>
                    <button class="btn btn-danger btn-sm" onclick="location.href='/admin/order/delete/<%= order._id %>/<%= order.orderedItems._id %>'">
                        <i class="bi bi-trash-fill"></i> Cancel
                    </button>
                    <button class="btn btn-info btn-sm" onclick="location.href='/admin/order/view/<%= order._id %>/<%= order.orderedItems._id %>'">
                        <i class="bi bi-eye"></i> View
                    </button>
                    <button class="btn btn-success btn-sm" onclick="location.href='/admin/order/block/<%= order._id %>/<%= order.orderedItems._id %>'">
                        <i class="bi bi-lock-fill"></i> Change Status
                    </button>
                   
                </td>
            </tr>
        <% }); %>
    </tbody>
</table>

<!-- Pagination Controls -->
 
<nav>
    <% if (totalPages > 1) { %> <!-- Only show pagination if more than 1 page -->
        <div class="pagination justify-content-center mt-4">
            <% if (currentPage > 1) { %>
                <a href="/admin/orders?page=<%= currentPage - 1 %>" class="btn btn-outline-secondary mr-2">Previous</a>
            <% } %>
            <% for (let i = 1; i <= totalPages; i++) { %>
                <a href="/admin/orders?page=<%= i %>" class="btn btn-outline-primary <%= i === currentPage ? 'active' : '' %> mr-1"><%= i %></a>
            <% } %>
            <% if (currentPage < totalPages) { %>
                <a href="/admin/orders?page=<%= currentPage + 1 %>" class="btn btn-outline-secondary ml-2">Next</a>
            <% } %>
        </div>
    <% } %>
    
</nav>

<script src="/js/adminJs/orders.js"></script>
<%- include("../../views/partials/admin/footer") %>